## Code coverage lake rules

### General

The rule file coverage.coffee defines lake rules for code coverage of the webapp.

To record coverage statistics the webapp JS files have to be instrumented by [Istanbul](https://github.com/gotwarlost/istanbul).
The instrumented JS files need to have the same directory structure as the original webapp and will be put in a
separate location.

Coverage statistics are generated by running the server unit and integration tests against the instrumented webapp.
These tests and their dependencies are copied to the appropriate locations in the instrumented webapp directory tree.

Tests will be started per feature via the [mocha_istanbul_test_runner.coffee](../../mocha_istanbul_test_runner.coffee)
helper script. This helper starts the instrumented webapp and runs the tests inside the context of the instrumented webapp.

### Manifest

#### Instrumented files
    server:
        scripts:
            files: [...]

These files will be instrumented and are part of the instrumented webapp.

#### Test Cases
    server:
        test:
            unit: [...]
            integration: [...]

The test cases defined by these files will be run against the instrumented webapp.

#### Test Exports/Dependencies
    server:
        test:
            exports: [...]

Files defined by this key contain code which is required by the test cases. They will be copied to the instrumented
directory tree.

#### Test Assets
    server:
        test:
            assets: [...]

Test Assets which will be copied to the instrumented directory tree. Assets can be arbitrary files which are needed to
run the tests.

#### Example
Old:

    server:
        scripts:
            files: ['server.coffee', 'lib.coffee']

        tests: ['test/unit_test.coffee']

    integrationTests:
        mocha: ['test/integration_test.coffee']
New:

    server:
        scripts:
            files: ['server.coffee', 'lib.coffee']

        test:
            unit: ['test/unit_test.coffee']
            integration: ['test/integration_test.coffee']
            exports: ['test/test_helper.coffee']
            assets: ['test/data/test_data.bin']

In this example there are two source files which build the REST-API of the feature. The REST-API part of the feature
 will be tested with an unit and an integration test. An export and an asset are declared which are used by the tests of
 this feature and/or tests in other features in the project.
